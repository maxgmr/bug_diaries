## The Problem

`rustc-1.86` builds on all architectures without issue in a [PPA](https://launchpad.net/~maxgmr/+archive/ubuntu/rustc-1.86-merge/+packages), but the build somehow [fails](https://launchpad.net/ubuntu/+source/rustc-1.86) after being uploaded to the archive!

The build log for the `onig_sys` crate shows a bunch of errors like this:

```
[onig_sys 69.8.1] cargo:warning=oniguruma/src/regparse.c:588:5: error: initialization of 'int (*)(void)' from incompatible pointer type 'int (*)(st_str_end_key *, st_str_end_key *)' [-Wincompatible-pointer-types]
```

My first instinct was to compare the failing build command between the successful PPA build (line 805441) and the failing proposed build (line 805488). The only difference was, for some reason, certain environment variables were wrapped in single quotes:

```diff
--- a/tmp/oni-success
+++ b/tmp/oni-fail
@@ -21,9 +21,9 @@ CARGO_CFG_TARGET_VENDOR=unknown \
 CARGO_CFG_UB_CHECKS='' \
 CARGO_CFG_UNIX='' \
 CARGO_ENCODED_RUSTFLAGS='-Cforce-frame-pointers=yes--cfg=bootstrap-Csymbol-mangling-version=v0-Zunstable-options--check-cfg=cfg(bootstrap)-Zmacro-backtrace-Csplit-debuginfo=off-Zunstable-options' \
-CARGO_MANIFEST_DIR='/<<PKGBUILDDIR>>/vendor/onig_sys-69.8.1' \
+CARGO_MANIFEST_DIR=/<<PKGBUILDDIR>>/vendor/onig_sys-69.8.1 \
 CARGO_MANIFEST_LINKS=onig \
-CARGO_MANIFEST_PATH='/<<PKGBUILDDIR>>/vendor/onig_sys-69.8.1/Cargo.toml' \
+CARGO_MANIFEST_PATH=/<<PKGBUILDDIR>>/vendor/onig_sys-69.8.1/Cargo.toml \
 CARGO_PKG_AUTHORS='Will Speak <will@willspeak.me>:Ivan Ivashchenko <defuz@me.com>' \
 CARGO_PKG_DESCRIPTION='' \
 CARGO_PKG_HOMEPAGE='' \
@@ -43,11 +43,11 @@ HOST=x86_64-unknown-linux-gnu \
 LD_LIBRARY_PATH='/<<PKGBUILDDIR>>/build/x86_64-unknown-linux-gnu/stage0-bootstrap-tools/release/deps:/<<PKGBUILDDIR>>/build/x86_64-unknown-linux-gnu/stage0-bootstrap-tools/release:/usr/lib/rust-1.85/lib/rustlib/x86_64-unknown-linux-gnu/lib' \
 NUM_JOBS=4 \
 OPT_LEVEL=3 \
-OUT_DIR='/<<PKGBUILDDIR>>/build/x86_64-unknown-linux-gnu/stage0-bootstrap-tools/x86_64-unknown-linux-gnu/release/build/onig_sys-652f26a3e4f22e03/out' \
+OUT_DIR=/<<PKGBUILDDIR>>/build/x86_64-unknown-linux-gnu/stage0-bootstrap-tools/x86_64-unknown-linux-gnu/release/build/onig_sys-652f26a3e4f22e03/out \
 PROFILE=release \
-RUSTC='/<<PKGBUILDDIR>>/build/bootstrap/debug/rustc' \
+RUSTC=/<<PKGBUILDDIR>>/build/bootstrap/debug/rustc \
 RUSTC_LINKER=x86_64-linux-gnu-gcc \
-RUSTC_WRAPPER='/<<PKGBUILDDIR>>/build/bootstrap/debug/rustc' \
-RUSTDOC='/<<PKGBUILDDIR>>/build/bootstrap/debug/rustdoc' \
+RUSTC_WRAPPER=/<<PKGBUILDDIR>>/build/bootstrap/debug/rustc \
+RUSTDOC=/<<PKGBUILDDIR>>/build/bootstrap/debug/rustdoc \
 TARGET=x86_64-unknown-linux-gnu \
 /<<PKGBUILDDIR>>/build/x86_64-unknown-linux-gnu/stage0-bootstrap-tools/release/build/onig_sys-9199f5ee3039859c/build-script-build
```

## Identifying the Cause

_How_ could a proposed builder differ from a PPA builder?

### Theory: usage of new GCC

Successful buildlog:

```
Get:7 http://ftpmaster.internal/ubuntu questing/main amd64 gcc-15-base amd64 15.1.0-8ubuntu1 [55.5 kB]
```

Failing buildlog:

```
Get:7 http://ftpmaster.internal/ubuntu questing-proposed/main amd64 gcc-15-base amd64 15.1.0-10ubuntu2 [56.3 kB]
```

The failing builder uses a newer GCC version, because it's using the `proposed` pocket!

In fact, this issue is known [upstream](https://github.com/rust-onig/rust-onig/issues/196), and comments suggest this is being caused by a newer GCC version enforcing a higher C standard. The `gcc-15_15.1.0` changelog even states `Bump standards version` right at the end.

### Testing the GCC theory

I've changed my successful PPA to use the `proposed` pocket instead to see if that makes the build fail.
